---
title: "Simulation Study of How Biodiversity Data Processing Lags affect Invasion Trend Analyses"
author: "Kelsey Brock"
date: "09/1/2021"
output: html_document
---

Specifically, we ask:
How do data processing time lags or the ways in which data are accessed affect interpretation, and can this be solved by truncating the time-window on which analyses are performed?
How does using the date of introduction versus the date of naturalization or reporting affect our interpretation of invasion trends?


```{r, }
require(knitr)
```
```{r}
#knitr::opts_knit$set(root.dir = "C:/Users/Kelsey/Documents/codingwork/simulation_study") #set the working directory
```
```{r}
#get the needed packages
if(!require("pacman")){
	install.packages("pacman")
	library(pacman)}
p_load("dplyr", "ggplot2", "viridis", "tidyr",  "fGarch", "sn", "purrr", "forcats")
```



### Hypothetical Reality = Species are naturalizing at a  linear rate
#### Step 1: Build Hypothetical Reality - Creating Species

Here, I'm going to create 1000 hypothetical species that naturalized between 1920 and 2020 using a random number generator where each year has an equal chance of coming up. 
```{r}
#creating the naturalized species, rounding to the nearest whole number (eg. year 1999 instead of 1999.433)
sim_spp <- round(runif(1000, min = 1920, max = 2020), digits = 0)
# and sort earliest to latest
sim_spp <- as.data.frame(sort(sim_spp, decreasing = FALSE))
#renaming the columns
colnames(sim_spp) <- "Naturalization_Year"
#naming the species a number (1 through 1000)
sim_spp$Species_IDNo <- seq(from = 1, to = nrow(sim_spp))
sim_spp
```

This histogram represents a scenario where the number of species varies per year, but there's no trend (increasing or decreasing) in the number naturalizing over time. 

#### Step 2: Simulate Hypothetical Reality - Creating Species Accumulation Curve
When, plotted as a species accumulation curve over time, it looks linear, like this:
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they naturalized
year_count <- as.data.frame(table(sim_spp$Naturalization_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Naturalized = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new records were reported in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated <- accumulate(year_count$Taxa_Naturalized, sum)
accumulated <- cbind(year_count, accumulated)
accumulated 
```
```{r}
#How many species per year, on average? 
#Should be about ten (1000 simulated species over 100 years)
startdate = 1920
enddate = 2020
startdate_num <- accumulated[which(accumulated$Year == startdate), 3]
enddate_num <- accumulated[which(accumulated$Year == enddate), 3]

(enddate_num - startdate_num) / (enddate - startdate)
```
```{r}
#plotting total species accumulation over time
ggplot(accumulated, aes(x=Year, y=accumulated)) +
  geom_line( color="#440154FF", size=2, alpha=0.9) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  theme_classic() +
  labs(title = "Hypothetical Reality: Species Accumulate Linearly Over Time", x = "Year", y = "Number of Species")
#ggsave(filename = "HR_Null1.png", device = "png", scale = 1, width =6, dpi = 600)
```
Here, I'm going to create 1000 hypothetical species that naturalized between 1920 and 2020 using a random number generator where each year has an equal chance of coming up. 
```{r}
#creating the naturalized species, rounding to the nearest whole number (eg. year 1999 instead of 1999.433)
sim_spp <- round(runif(1000, min = 1920, max = 2020), digits = 0)
# and sort earliest to latest
sim_spp <- as.data.frame(sort(sim_spp, decreasing = FALSE))
#renaming the columns
colnames(sim_spp) <- "Naturalization_Year"
#naming the species a number (1 through 1000)
sim_spp$Species_IDNo <- seq(from = 1, to = nrow(sim_spp))
#plotting histogram
ggplot(sim_spp, aes(x = Naturalization_Year)) +
  geom_histogram(binwidth = 1) +
  theme_classic()

```

# Scenario 1:
### Hypothetical Reality = Species are accumulating linearly
### Lags = Lags exist, and they're all about 10 years long
### Analyse Trends based on = A) Date of vouchered specimen, and B) Date the species is reported as new C) date of intoduction



## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp1 <- sim_spp
sim_spp1
```


##### 3.0
Simulate the lag between introduction and naturalization


```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```



##### 3.3


third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp1$Intro_Year <- sim_spp1$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp1$Detect_Year <- sim_spp1$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp1$Voucher_Year <- sim_spp1$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp1$ID_Year <- sim_spp1$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp1$Report_Year <- sim_spp1$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp1$Compile_Year <- sim_spp1$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp1$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp1 <- sim_spp1 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp1
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp1, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```


You cannot keep all of these species, because hypothetically, it's 2020 and you don't know which species to analyze if they haven't been reported yet
```{r}
sim_spp1_crop <- subset(sim_spp1, Report_Year <= 2020)
```

How many species did we lose that hadn't been reported yet?

```{r}
nrow(sim_spp1) -nrow(sim_spp1_crop)
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp1_crop$Naturalization_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp1_crop$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp1_crop$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp1_crop$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp1_crop$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"
```
```{r}
accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario1 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario1_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.75) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "All lags have mean = 10 years +/- SD of 3 years", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario1.png", device = "png", scale = 1, width =6, dpi = 600)
```

Important finding:  trying to approximate the date of introduction versus the date of naturalization requires more truncation of the time window (although by how long, no one knows).





## SCENARIO 2: DATA PROCESSING LAGS ARE DECREASING OVER TIME

For this scenario, let's say that the sum of all the lags is somewhere between 0 and about 15 years, with most species having a total lag time of 5-7 years and a lag time of 0 isn't really possible

```{r}
sim_spp2 <- sim_spp
sim_spp2
```


##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=50)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=50)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```
##### 3.3
third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years

```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp2, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)

paramdf
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Vouch_ID_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Vouch_ID_Lag <- as.data.frame(Vouch_ID_Lag)
 Vouch_ID_Lag
```

```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp2, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)

paramdf
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

ID_Report_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 ID_Report_Lag <-as.data.frame(ID_Report_Lag)
 ID_Report_Lag
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 )#& ID_Report_Lag <=10)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + 0,

```{r}
sim_spp2
# Naturalization Year is already there
```
All created by adding or subtracting from the naturalization year
```{r}
sim_spp2$Intro_Year <- sim_spp2$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp2$Detect_Year <- sim_spp2$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp2$Voucher_Year <- sim_spp2$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp2$ID_Year <- sim_spp2$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp2$Report_Year <- sim_spp2$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp2$Compile_Year <- sim_spp2$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp2$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp2 <- sim_spp2 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp2
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp2, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```


You cannot keep all of these species, because hypothetically, it's 2020 and you don't know which species to analyze if they haven't been reported yet
```{r}
sim_spp2_crop <- subset(sim_spp2, Report_Year <= 2020)
```

How many species did we lose that hadn't been reported yet?

```{r}
nrow(sim_spp2) -nrow(sim_spp2_crop)
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp2_crop$Naturalization_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp2_crop$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp2_crop$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```

## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp2_crop$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp2_crop$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"
```
```{r}
accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```



```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
 theme_classic() +
  labs(title = "Scenario 2 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario2_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.8) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
   guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Data Processing Lags Become Shorter Over Time", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario2.png", device = "png", scale = 1, width =6, dpi = 600)
```


## SCENARIO 3: FIELD SURVEYING LAGS ARE DECREASING OVER TIME

For this scenario, let's say that the sum of all the lags is somewhere between 0 and about 15 years, with most species having a total lag time of 5-7 years and a lag time of 0 isn't really possible

```{r}
sim_spp3 <- sim_spp
sim_spp3
```


##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=50)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 


```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp3, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)

```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Nat_Detect_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Nat_Detect_Lag <- as.data.frame(Nat_Detect_Lag)
 Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0

paramdf <- merge(sim_spp3, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Detect_Vouch_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Detect_Vouch_Lag <- as.data.frame(Detect_Vouch_Lag)
Detect_Vouch_Lag
```
##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + 0,

```{r}
sim_spp3
# Naturalization Year is already there
```
All created by adding or subtracting from the naturalization year
```{r}
sim_spp3$Intro_Year <- sim_spp3$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp3$Detect_Year <- sim_spp3$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp3$Voucher_Year <- sim_spp3$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp3$ID_Year <- sim_spp3$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp3$Report_Year <- sim_spp3$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
sim_spp3$Compile_Year <- sim_spp3$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp3$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp3 <- sim_spp3 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp3
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp3, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```


You cannot keep all of these species, because hypothetically, it's 2020 and you don't know which species to analyze if they haven't been reported yet
```{r}
sim_spp3_crop <- subset(sim_spp3, Report_Year <= 2020)
```

How many species did we lose that hadn't been reported yet?

```{r}
nrow(sim_spp3) -nrow(sim_spp3_crop)
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp3_crop$Naturalization_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp3_crop$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp3_crop$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```

## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp3_crop$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp3_crop$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"
```
```{r}
accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```



```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
 theme_classic() +
  labs(title = "Scenario 3 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario3_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.8) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
   guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Field Surveying Lags Become Shorter Over Time", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario3.png", device = "png", scale = 1, width =6, dpi = 600)
```





## SCENARIO 4: BOTH FIELD SURVEYING & DATA PROCESSING LAGS ARE DECREASING OVER TIME

For this scenario, let's say that the sum of all the lags is somewhere between 0 and about 15 years, with most species having a total lag time of 5-7 years and a lag time of 0 isn't really possible

```{r}
sim_spp4 <- sim_spp
sim_spp4
```


##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=50)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 


```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp4, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)

```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Nat_Detect_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Nat_Detect_Lag <- as.data.frame(Nat_Detect_Lag)
 Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp4, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Detect_Vouch_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Detect_Vouch_Lag <- as.data.frame(Detect_Vouch_Lag)
Detect_Vouch_Lag
```
##### 3.3
third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years


```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp4, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)

paramdf
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

Vouch_ID_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 Vouch_ID_Lag <- as.data.frame(Vouch_ID_Lag)
 Vouch_ID_Lag
```

```{r}
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

allthemeans <- as.data.frame(seq(from = 20, to = 1, length.out = nrow(alltheyears))) 
colnames(allthemeans) <- "xi"

#alltheskews <- as.data.frame(seq(from = 2.5, to = 28,  length.out = nrow(alltheyears))) 
#colnames(alltheskews) <- "alpha"

paramdf <- cbind(alltheyears, allthemeans)
paramdf$omega <- 3
paramdf$alpha <- 0


paramdf <- merge(sim_spp4, paramdf, by.x = "Naturalization_Year", by.y = "Year", all.x = TRUE, all.y = FALSE) %>% dplyr::select(Naturalization_Year, xi, alpha, omega)
```


```{r}
get_lag <- function(x, o, a) {  
    get_lag <- c() 
    get_lag <- abs(sample(round(sn::rsn(1000, xi = x, omega =o, alpha = a)), 1))
}

ID_Report_Lag <- mapply(x = paramdf$xi, o =paramdf$omega, a = paramdf$alpha, FUN = get_lag)
 #dists <- cbind(alltheyears, as.data.frame(t(dists)))
 ID_Report_Lag <-as.data.frame(ID_Report_Lag)
 ID_Report_Lag
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 )#& ID_Report_Lag <=10)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + 0,

```{r}
sim_spp4
# Naturalization Year is already there
```
All created by adding or subtracting from the naturalization year
```{r}
sim_spp4$Intro_Year <- sim_spp4$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp4$Detect_Year <- sim_spp4$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp4$Voucher_Year <- sim_spp4$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp4$ID_Year <- sim_spp4$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp4$Report_Year <- sim_spp4$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


###sim_spp4$Compile_Year <- sim_spp4$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp4$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp4 <- sim_spp4 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp4
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp4, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```


You cannot keep all of these species, because hypothetically, it's 2020 and you don't know which species to analyze if they haven't been reported yet
```{r}
sim_spp4_crop <- subset(sim_spp4, Report_Year <= 2020)
```

How many species did we lose that hadn't been reported yet?

```{r}
nrow(sim_spp4) -nrow(sim_spp4_crop)
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp4_crop$Naturalization_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp4_crop$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp4_crop$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```

## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp4_crop$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp4_crop$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"
```
```{r}
accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```



```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
   guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario 2 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario2_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.8) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
 theme_classic() +
  labs(title = "Field Surveying & Data Processing Lags Become Shorter Over Time", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario4.png", device = "png", scale = 1, width =6, dpi = 600)
```

# ACCESSIBILITY PART

# Scenario 5: Access Points Introduce different cutoff points : ID'd vouchers

- prevents leveling off, but excludes species because not all vouchers mentions their status


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp5 <- sim_spp
sim_spp5
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp5$Intro_Year <- sim_spp5$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp5$Detect_Year <- sim_spp5$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp5$Voucher_Year <- sim_spp5$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp5$ID_Year <- sim_spp5$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp5$Report_Year <- sim_spp5$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp5$Compile_Year <- sim_spp5$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp5$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp5 <- sim_spp5 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp5
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp5, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp5_crop <- subset(sim_spp5, ID_Year <= 2020)
sim_spp5_crop
```

```{r}
nrow(sim_spp5) -nrow(sim_spp5_crop)
```
```{r}
retrieval_rate = 1
sampled <- as.data.frame(sample(sim_spp5_crop$Species_IDNo, (nrow(sim_spp5_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp5_crop_sample <- merge(sampled, sim_spp5_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp5_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp5_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp5_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp5_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp5_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp5_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario5 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario5_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Access Point = Identified Specimens deposited in Natural History Collections", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario5.png", device = "png", scale = 1, width =6, dpi = 600)
```

# Scenario 6: Access Points Introduce different cutoff points : REPORTS

- prevents leveling off, but excludes species because not all vouchers mentions their status


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp6 <- sim_spp
sim_spp6
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp6$Intro_Year <- sim_spp6$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp6$Detect_Year <- sim_spp6$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp6$Voucher_Year <- sim_spp6$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp6$ID_Year <- sim_spp6$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp6$Report_Year <- sim_spp6$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp6$Compile_Year <- sim_spp6$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp6$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp6 <- sim_spp6 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp6
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp6, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp6_crop <- subset(sim_spp6, Report_Year <= 2020)
sim_spp6_crop
```

```{r}
nrow(sim_spp6) -nrow(sim_spp6_crop)
```
```{r}
retrieval_rate = 1
sampled <- as.data.frame(sample(sim_spp6_crop$Species_IDNo, (nrow(sim_spp6_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp6_crop_sample <- merge(sampled, sim_spp6_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp6_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp6_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp6_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp6_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp6_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp6_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario6 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario6_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Access Point = Published Reports on Naturalization Status", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario6.png", device = "png", scale = 1, width =6, dpi = 600)
```

# Scenario 7: Access Points Introduce different cutoff points : CONTINUALLY UPDATED DATABASE WITH LAG BETWEEN REPORT AND COMPILE

- prevents leveling off, but excludes species because not all vouchers mentions their status


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp7 <- sim_spp
sim_spp7
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp7$Intro_Year <- sim_spp7$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp7$Detect_Year <- sim_spp7$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp7$Voucher_Year <- sim_spp7$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp7$ID_Year <- sim_spp7$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp7$Report_Year <- sim_spp7$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp7$Compile_Year <- sim_spp7$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp7$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp7 <- sim_spp7 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp7
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp7, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp7_crop <- subset(sim_spp7, Compile_Year <= 2020)
sim_spp7_crop
```

```{r}
nrow(sim_spp7) -nrow(sim_spp7_crop)
```
```{r}
retrieval_rate = 1
sampled <- as.data.frame(sample(sim_spp7_crop$Species_IDNo, (nrow(sim_spp7_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp7_crop_sample <- merge(sampled, sim_spp7_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp7_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp7_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp7_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp7_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp7_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp7_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario7 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario7_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Access Point = Continually Updated Database (with report-compilation lag)", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario7.png", device = "png", scale = 1, width =6, dpi = 600)
```

# Scenario 8: Access Points Introduce different cutoff points: Checklist-style resource compiled 3 years ago.

- prevents leveling off, but excludes species because not all vouchers mentions their status


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp8 <- sim_spp
sim_spp8
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp8$Intro_Year <- sim_spp8$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp8$Detect_Year <- sim_spp8$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp8$Voucher_Year <- sim_spp8$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp8$ID_Year <- sim_spp8$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp8$Report_Year <- sim_spp8$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp8$Compile_Year <- sim_spp8$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp8$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp8 <- sim_spp8 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp8
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp8, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp8_crop <- subset(sim_spp8, Report_Year <= 2017)
sim_spp8_crop
```

```{r}
nrow(sim_spp8) -nrow(sim_spp8_crop)
```
```{r}
retrieval_rate = 1
sampled <- as.data.frame(sample(sim_spp8_crop$Species_IDNo, (nrow(sim_spp8_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp8_crop_sample <- merge(sampled, sim_spp8_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp8_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp8_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp8_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp8_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp8_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp8_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario8 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario8_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Access Point = Compiled Resource published in 2017", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario8.png", device = "png", scale = 1, width =6, dpi = 600)
```

# Scenario 9: Access Points Introduce different cutoff points: Checklist-style resource compiled 30 years ago.

- prevents leveling off, but excludes species because not all vouchers mentions their status


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp9 <- sim_spp
sim_spp9
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp9$Intro_Year <- sim_spp9$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp9$Detect_Year <- sim_spp9$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp9$Voucher_Year <- sim_spp9$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp9$ID_Year <- sim_spp9$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp9$Report_Year <- sim_spp9$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp9$Compile_Year <- sim_spp9$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp9$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp9 <- sim_spp9 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp9
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp9, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp9_crop <- subset(sim_spp9, Report_Year <= 1990)
sim_spp9_crop
```

```{r}
nrow(sim_spp9) -nrow(sim_spp9_crop)
```
```{r}
retrieval_rate = 1
sampled <- as.data.frame(sample(sim_spp9_crop$Species_IDNo, (nrow(sim_spp9_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp9_crop_sample <- merge(sampled, sim_spp9_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp9_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp9_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp9_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp9_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp9_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```


## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp9_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario9 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario9_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Access Point = Compiled Resource published in 1990", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario9.png", device = "png", scale = 1, width =6, dpi = 600)
```



# COMPLETENESS PART
# Scenario 10: 33.33% completeness


## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp10 <- sim_spp
sim_spp10
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp10$Intro_Year <- sim_spp10$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp10$Detect_Year <- sim_spp10$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp10$Voucher_Year <- sim_spp10$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp10$ID_Year <- sim_spp10$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp10$Report_Year <- sim_spp10$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp10$Compile_Year <- sim_spp10$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp10$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp10 <- sim_spp10 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp10
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp10, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp10_crop <- subset(sim_spp10, Report_Year <= 2020)
sim_spp10_crop
```

```{r}
nrow(sim_spp10) -nrow(sim_spp10_crop)
```
```{r}
retrieval_rate = .3333333
sampled <- as.data.frame(sample(sim_spp10_crop$Species_IDNo, (nrow(sim_spp10_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp10_crop_sample <- merge(sampled, sim_spp10_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp10_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp10_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp10_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp10_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp10_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```

## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp8_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario11 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario11_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Low Completeness: 33% of naturalized spp. included", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario11.png", device = "png", scale = 1, width =6, dpi = 600)
```
# Scenario 11: 66.67% completeness

## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp11 <- sim_spp
sim_spp11
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp11$Intro_Year <- sim_spp11$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp11$Detect_Year <- sim_spp11$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp11$Voucher_Year <- sim_spp11$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp11$ID_Year <- sim_spp11$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp11$Report_Year <- sim_spp11$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp11$Compile_Year <- sim_spp11$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp11$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp11 <- sim_spp11 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp11
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp11, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

MAJOR DIFFERENCE: you get to crop based on the ID year, because you're looking at the vouchers themselves
How many species did we lose that hadn't been reported yet?
```{r}
sim_spp11_crop <- subset(sim_spp11, Report_Year <= 2020)
sim_spp11_crop
```

```{r}
nrow(sim_spp11) -nrow(sim_spp11_crop)
```
```{r}
retrieval_rate = .666667
sampled <- as.data.frame(sample(sim_spp11_crop$Species_IDNo, (nrow(sim_spp11_crop)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp11_crop_sample <- merge(sampled, sim_spp11_crop, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp11_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp11_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp11_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp11_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp11_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```

## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp11_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario11 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario11_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Moderate Completeness: 67% of naturalized spp. included", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario11.png", device = "png", scale = 1, width =6, dpi = 600)
```





# REAL-WOLRD MIXED EFFECTS PART


# Scenario 12: Mixed data: 95% complete compilation published in 1985, 67% complete filling in until 2020 based on reports

## Simulate Hypothetical Lag Times

For this scenario, let's say that all lags have a mean of 10 years

```{r}
sim_spp12 <- sim_spp
sim_spp12
```

##### 3.0
Simulate the lag between introduction and naturalization

```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Intro_Nat_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"
Intro_Nat_Lag <- subset(Intro_Nat_Lag, Intro_Nat_Lag >=0 & Intro_Nat_Lag <=20)
Intro_Nat_Lag <- as.data.frame(sample(Intro_Nat_Lag$Intro_Nat_Lag, 1000))
colnames(Intro_Nat_Lag) <- "Intro_Nat_Lag"

#plotting histogram
ggplot(Intro_Nat_Lag, aes(x = Intro_Nat_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Intro_Nat_Lag)
#Nat_Detect_Lag
```

##### 3.1
Then, simulate the lag between naturalization and detection
let's say this takes around 5 years, with some taking a very long time 
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Nat_Detect_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
Nat_Detect_Lag <- subset(Nat_Detect_Lag, Nat_Detect_Lag >=0 & Nat_Detect_Lag <=20)
Nat_Detect_Lag <- as.data.frame(sample(Nat_Detect_Lag$Nat_Detect_Lag, 1000))
colnames(Nat_Detect_Lag) <- "Nat_Detect_Lag"
#plotting histogram
ggplot(Nat_Detect_Lag, aes(x = Nat_Detect_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Nat_Detect_Lag)
#Nat_Detect_Lag
```
##### 3.2
Second, simulate the lag between detection and evidence collection
let's say this takes around 1 years, with some taking longer, up to 5 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Detect_Vouch_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
Detect_Vouch_Lag <- subset(Detect_Vouch_Lag, Detect_Vouch_Lag >=0 & Detect_Vouch_Lag <=20)
Detect_Vouch_Lag <- as.data.frame(sample(Detect_Vouch_Lag$Detect_Vouch_Lag, 1000))
colnames(Detect_Vouch_Lag) <- "Detect_Vouch_Lag"
#plotting histogram
ggplot(Detect_Vouch_Lag, aes(x = Detect_Vouch_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Detect_Vouch_Lag)

```

##### 3.3

third, simulate the lag between vouchering and identification
let's say this takes around 1 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Vouch_ID_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
Vouch_ID_Lag <- subset(Vouch_ID_Lag, Vouch_ID_Lag >=0 & Vouch_ID_Lag <=20)
Vouch_ID_Lag <- as.data.frame(sample(Vouch_ID_Lag$Vouch_ID_Lag, 1000))
colnames(Vouch_ID_Lag) <- "Vouch_ID_Lag"
#plotting histogram
ggplot(Vouch_ID_Lag, aes(x = Vouch_ID_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Vouch_ID_Lag)
```
##### 3.4
Then, simulate the lag between IDing and reporting
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

ID_Report_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
ID_Report_Lag <- subset(ID_Report_Lag, ID_Report_Lag >=0 & ID_Report_Lag <=20)
ID_Report_Lag <- as.data.frame(sample(ID_Report_Lag$ID_Report_Lag, 1000))
colnames(ID_Report_Lag) <- "ID_Report_Lag"
#plotting histogram
ggplot(ID_Report_Lag, aes(x = ID_Report_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(ID_Report_Lag)
```


HMMM!  I'm not sure this really works like this.  Isn't it more like someone comes in, and then just compiles everything that they can at once, no matter if they were reported 1 year ago, or 30?  Yes....

##### 3.5
Then, simulate the lag between reporting  and when someone makes a resource that is compiled and formatted
let's say this takes around 2 years, with some taking longer, up to 10 years
```{r}
mean = 10
SD = 3
skew = 0
params <- sn::cp2dp(c(mean, SD, skew), "SN")

Report_Compile_Lag <- as.data.frame(round(sn::rsn(10000, dp =params), digits = 0))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
Report_Compile_Lag <- subset(Report_Compile_Lag, Report_Compile_Lag >=0 & Report_Compile_Lag <=20)
Report_Compile_Lag <- as.data.frame(sample(Report_Compile_Lag$Report_Compile_Lag, 1000))
colnames(Report_Compile_Lag) <- "Report_Compile_Lag"
#plotting histogram
ggplot(Report_Compile_Lag, aes(x = Report_Compile_Lag)) +
  geom_histogram(binwidth = 1) +
  theme_classic()
summary(Report_Compile_Lag)
```

So, it may be arbitrary, but the report would compile all species up to that date.

##### 3.6 Okay, lets add up the lags
So, the timing of the collected voucher AND final "new record report" is just the year the species naturalized + lag,

All created by adding or subtracting from the naturalization year
```{r}
sim_spp12$Intro_Year <- sim_spp12$Naturalization_Year - Intro_Nat_Lag$Intro_Nat_Lag
sim_spp12$Detect_Year <- sim_spp12$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag
sim_spp12$Voucher_Year <- sim_spp12$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag
sim_spp12$ID_Year <- sim_spp12$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag
sim_spp12$Report_Year <- sim_spp12$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag


sim_spp12$Compile_Year <- sim_spp12$Naturalization_Year + Nat_Detect_Lag$Nat_Detect_Lag + Detect_Vouch_Lag$Detect_Vouch_Lag + Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag + Report_Compile_Lag$Report_Compile_Lag


sim_spp12$All_Processing_Lags <- Vouch_ID_Lag$Vouch_ID_Lag + ID_Report_Lag$ID_Report_Lag
#reordering according to Report Year
sim_spp12 <- sim_spp12 %>% dplyr::select(Species_IDNo, Intro_Year, Naturalization_Year, Detect_Year, Voucher_Year, ID_Year, Report_Year, Compile_Year, All_Processing_Lags)
sim_spp12
```

### Cropping the Dataset because we can't know about species that haven't been reported yet

What's the lags look like for all species
```{r}
#plotting histogram
ggplot(sim_spp12, aes(x = All_Processing_Lags)) +
  geom_density(fill="#440154FF", color="#e9ecef", alpha=0.6) +
 # scale_x_continuous(breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_classic()
```

### MIXED DATA
```{r}
sim_spp12_1985compile <- subset(sim_spp12, ID_Year <= 1985)
sim_spp12_1985compile
```

```{r}
nrow(sim_spp12) -nrow(sim_spp12_1985compile)
```
```{r}
retrieval_rate = .95
sampled <- as.data.frame(sample(sim_spp12_1985compile$Species_IDNo, (nrow(sim_spp12_1985compile)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp12_1985compile <- merge(sampled, sim_spp12_1985compile, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp12_1985compile
```

```{r}
sim_spp12_recentreports <- subset(sim_spp12, ID_Year > 1985)
sim_spp12_recentreports <- subset(sim_spp12_recentreports, Report_Year <= 2020)
sim_spp12_recentreports
```
```{r}
retrieval_rate = .67
sampled <- as.data.frame(sample(sim_spp12_recentreports$Species_IDNo, (nrow(sim_spp12_recentreports)* retrieval_rate)))
colnames(sampled) <- "Species_IDNo"
sim_spp12_recentreports <- merge(sampled, sim_spp12_recentreports, by= "Species_IDNo", all.x = TRUE, all.y = FALSE)
sim_spp12_recentreports
```

### Now recompiling the data frame again

```{r}
sim_spp12_crop_sample <- rbind(sim_spp12_1985compile, sim_spp12_recentreports)
sim_spp12_crop_sample
```

#### Show the number of first records over time, if the researcher were unaware of the unreported species and didn't truncate the time window

```{r}
records_per_year <- as.data.frame(table(sim_spp12_crop_sample$Voucher_Year))
#renaming columns
records_per_year <- records_per_year %>% dplyr::rename(Year = Var1, records_per_year = Freq)

#plotting histogram
graph <- records_per_year %>%
ggplot( aes(x = Year, y=records_per_year))+ 
    geom_point( ) +
    scale_fill_viridis(discrete = T) +
    theme_classic(base_size = 13) +
    labs(title = "First Record Rate", element_text(size = 13)) +
  theme(legend.position = "none", axis.text.x = element_blank(), plot.title = element_text(size = 13))
graph


#ggsave(filename = "intropath_v_continent.png", device = "png", scale = 1, width =6, dpi = 600)

```
Can we find the best model to fit this line?  Look at Seebens' code.

## Step 4. Analyse Trends - A) Voucher Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they we vouchered
year_count <- as.data.frame(table(sim_spp12_crop_sample$Voucher_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Vouchered = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0

#calculating species accumulation over time
accumulated_A <- accumulate(year_count$Taxa_Vouchered, sum)
accumulated_A <- cbind(year_count, accumulated_A)
accumulated_A 
```

## Step 5. Analyse Trends - B) Report Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp12_crop_sample$Report_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Reported = Freq)

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_B <- accumulate(year_count$Taxa_Reported, sum)
accumulated_B <- cbind(year_count, accumulated_B)
accumulated_B 
```
## Step 6. Analyse Trends - C) Intro Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp12_crop_sample$Intro_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Introduced = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_C <- accumulate(year_count$Taxa_Introduced, sum)
accumulated_C <- cbind(year_count, accumulated_C)
accumulated_C 
```

## Step 6. Analyse Trends - D) Compiled Year 
```{r}
#just making a vector of years from 1920 to 2020
alltheyears <- as.data.frame(seq(from = 1920, to = 2020))
colnames(alltheyears) <- "Year"

#grouping my simulated species by the year they were reported
year_count <- as.data.frame(table(sim_spp8_crop_sample$Compile_Year)) %>%
# and renaming columns
  dplyr::rename(Year = Var1, Taxa_Compiled = Freq)
year_count

#merging with all the years
year_count <-merge(alltheyears, year_count, all = TRUE)
#making the NA's become 0s, because 0 new species were vouchered in those years
year_count[is.na(year_count)] = 0
#calculating species accumulation over time
accumulated_D <- accumulate(year_count$Taxa_Compiled, sum)
accumulated_D <- cbind(year_count, accumulated_D)
accumulated_D 
```

```{r}
#making into a single dataframe
#accumulated  <- accumulated %>% dplyr::rename(accumulated_species = accumulated, No_Taxa = Taxa_Naturalized)
accumulated_A  <- accumulated_A %>% dplyr::rename(accumulated_species = accumulated_A, No_Taxa = Taxa_Vouchered)
accumulated_B  <- accumulated_B %>% dplyr::rename(accumulated_species = accumulated_B, No_Taxa = Taxa_Reported)
accumulated_C  <- accumulated_C %>% dplyr::rename(accumulated_species = accumulated_C, No_Taxa = Taxa_Introduced)
accumulated_D  <- accumulated_D %>% dplyr::rename(accumulated_species = accumulated_D, No_Taxa = Taxa_Compiled)
accumulated$Analysis_Type <- "Hypothetical Naturalization Date"
accumulated_A$Analysis_Type <- "Evidence Collection Date"
accumulated_B$Analysis_Type <- "Report Date"
accumulated_C$Analysis_Type <- "Introduction Date"
accumulated_D$Analysis_Type <- "Compiled Date"

accumulated_A_B_C_D <- rbind(accumulated, accumulated_A, accumulated_B, accumulated_C, accumulated_D)
accumulated_A_B_C_D
```

```{r}
DATA <- accumulated_A_B_C_D %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(No_Taxa), group = Analysis_Type, color = Analysis_Type)) +
  geom_smooth( size=1.5, alpha=0.8, level = 0, method = "loess", fullrange=TRUE) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  labs(title = "Scenario12 Nat Rate", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario12_ rate.png", device = "png", scale = 1, width =6, dpi = 600)
```

```{r}
DATA <- accumulated_A_B_C_D# %>% mutate(Analysis_Type = fct_reorder(Analysis_Type, accumulated_species))
DATA <- subset(DATA, DATA$Analysis_Type != "Report Date")
DATA <- subset(DATA, DATA$Analysis_Type != "Compiled Date")
#plotting total species accumulation over time
ggplot(DATA, aes(x=as.numeric(Year), y=as.numeric(accumulated_species), group = Analysis_Type, color = Analysis_Type)) +
  geom_line( size=1.5, alpha=0.70) +
  scale_color_viridis(discrete = TRUE) +
  scale_x_continuous(breaks = c(1920, 1940, 1960, 1980, 2000, 2020)) +
  guides(colour = guide_legend(reverse=T)) +
 theme_classic() +
  theme(legend.title=element_blank()) +
  labs(title = "Mix of Data Used", x = "Year", y = "Number of Species")
ggsave(filename = "Scenario1.png", device = "png", scale = 1, width =6, dpi = 600)
```